<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <!-- including ECharts file -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@4.5.0/dist/echarts.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	
</head>
<body>
	<div>
		<div>
			<input type="text" id="excludeFilterInput"   size="10">
			<button id = "ExludeFilterButton">Start</button>
		</div>
	</div>
    <!-- prepare a DOM container with width and height -->
    <div id="main" style="width: 100%; min-height: 600px"></div>
	<script type="text/javascript">

		function drawChart(data,excludeFilterValue) {
			
			var timestamps = data.map(function(val) {
				time = new Date(val.OpenTime);
				return time
			});
			
			var candlesticks = data.map(function(val) {
				return [val.OpenPrice,val.ClosePrice,val.LowPrice,val.HighPrice];
			});
			
			var markPoints = data.reduce(function(filtered,candlestick,index) {

			    if (candlestick.IsRSIReverseLow && candlestick.RSIBestPeriod > excludeFilterValue) {

			        filtered.push({name: 'test_' + candlestick.OpenTime, value: candlestick.RSIBestPeriod, xAxis: index, yAxis: candlestick.LowPrice});
			    }

			    return filtered;
			},[]);
			

			// specify chart configuration item and data
			var option = {
				animation: false,
				tooltip: {
					trigger: 'axis',
					axisPointer: {
						animation: false,
						type: 'cross',
						lineStyle: {
							width: 2,
							opacity: 1
						}
					}
				},
				xAxis: {
					data: timestamps,
					scale: true,
					axisPointer: {
						z: 100
					},
					axisLine: {
						onZero: false
					}
				},
				yAxis: [{
					scale: true,
					splitArea: {
						show: true
					},
					axisPointer: {
						z: 100
					}
				}],
				axisPointer: {
					link: {
						xAxisIndex: 'all'
					},
					label: {
						backgroundColor: '#777'
					}
				},
				dataZoom: [{ type: 'inside' }],
				series: [{
					name: 'cnd_data',
					type: 'k',
					data: candlesticks,
					itemStyle: {
						normal: {
							color0: '#FD1050',
							color: '#0CF49B',
							borderColor0: '#FD1050',
							borderColor: '#0CF49B'
						}
					},
					markPoint: {
                         data: markPoints
                    },
				}]
			};
			
			// use configuration item and data specified to show chart
			myChart.setOption(option);
			
			
		}

		$('#ExludeFilterButton').click(function() {

			var excludeFilterValue = $('#excludeFilterInput').val() * 1 || 0;
			drawChart(chartData,excludeFilterValue);

		});
	
		var symbol = "{{.Symbol}}";
		var timeframe = "{{.Timeframe}}";

		var ChartData = null;

	
		// based on prepared DOM, initialize echarts instance
		var myChart = echarts.init(document.getElementById('main'));

		$.getJSON("/chart/" + symbol + "/" + timeframe, function(data) {

			chartData = data;

			drawChart(data,0);
		
		});
        
    </script>
</body>

</html>
